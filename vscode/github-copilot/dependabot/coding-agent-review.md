# Dependabot PR 包括調査プロンプト（コーディングエージェント版）

**🤖 GitHubコーディングエージェント専用**  
このプロンプトは `#github-pull-request_copilot-coding-agent` での自動実行に最適化されています。

## 🎯 実行指示

以下の手順でDependabot PRの包括調査を実行し、調査専用ブランチで結果をレポート化してください：

### 📋 調査対象の特定
**対象PR**: [PR番号またはPR URL]

### 🚀 調査実行フロー

#### Phase 1: PR情報の自動取得とセットアップ
1. **PR詳細情報の取得**
   ```bash
   # PR番号が指定された場合
   gh pr view [PR番号] --json title,body,files,author,headRefName,baseRefName

   # PR URLが指定された場合  
   gh pr view [PR_URL] --json title,body,files,author,headRefName,baseRefName
   ```

2. **パッケージ情報の自動抽出**
   - PRタイトルからパッケージ名とバージョンを抽出
   - PRの変更ファイル（Gemfile.lock, package-lock.json等）を解析
   - 更新前後のバージョンを特定

3. **調査専用ブランチ作成**
   ```bash
   # パッケージ情報を自動取得後にブランチ名を生成
   git checkout -b dependabot-analysis/[自動取得したpackage-name]-[自動取得したnew-version]-investigation
   ```

4. **調査ディレクトリ準備**
   ```bash
   mkdir -p dependabot-review/#[自動取得したPR番号]
   ```

5. **詳細パッケージ情報収集**
   - GitHub リリースページ確認
   - CHANGELOG/リリースノート調査
   - 公式ドキュメント確認
   - npm info / gem info による詳細取得

#### Phase 2: 影響範囲分析
1. **使用箇所特定**
   ```bash
   # パッケージ使用箇所の徹底検索（パッケージ名は自動取得）
   grep -r "[自動取得したpackage-name]" --include="*.rb" --include="*.js" --include="*.ts" --include="*.tsx" --include="*.json" --include="*.yml" --include="*.gemspec" --include="package*.json" .
   
   # 依存関係確認
   bundle list | grep [自動取得したpackage-name]  # Ruby
   npm ls [自動取得したpackage-name]              # Node.js
   ```

2. **設定ファイル影響確認**
   - Gemfile / package.json
   - .rubocop.yml / .eslintrc等
   - CI/CD設定ファイル

#### Phase 3: 詳細調査とテスト実行
1. **セキュリティチェック**
   ```bash
   # Ruby
   bundle audit
   brakeman --no-pager -q
   
   # Node.js
   npm audit
   ```

2. **静的解析実行**
   ```bash
   # Ruby
   bundle exec standardrb
   
   # TypeScript/JavaScript
   npm run lint
   npm run type-check
   ```

3. **動作テスト**
   - パッケージ主要機能の動作確認
   - エラーハンドリング確認
   - パフォーマンス影響確認

#### Phase 4: レポート生成
以下の3つのレポートファイルを自動生成：

## 📄 レポートテンプレート

### 1. メイン調査レポート
**ファイル**: `dependabot-review/#[自動取得したPR番号]/dependabot-review-main-report.md`

```markdown
# 🤖 Dependabot PR調査レポート - [自動取得したpackage-name]

## 📦 更新概要
- **パッケージ**: [自動取得したpackage-name]
- **更新前**: [自動取得したold-version]
- **更新後**: [自動取得したnew-version]
- **更新種別**: [自動判定: patch/minor/major]
- **セキュリティ修正**: [自動判定: Yes/No]
- **リリース日**: [自動取得したrelease-date]
- **元PR**: #[自動取得したPR番号]

## 📚 ライブラリ詳細
### 基本情報
- **ライブラリ名**: [自動取得したpackage-name]
- **公式説明**: [公式READMEからの引用]
- **カテゴリ**: [自動判定: テスト/ビルド/UI/データベース/セキュリティ/その他]
- **開発者・組織**: [自動取得したメンテナー情報]
- **公式リポジトリ**: [自動取得したGitHub URL]
- **ライセンス**: [自動取得したライセンス種別]
- **人気度**: [自動取得した週間DL数/GitHubスター数]

### このライブラリが解決する問題
- **解決する課題**: [具体的な問題]
- **代替手段**: [他の選択肢]
- **プロジェクトでの採用理由**: [なぜこのライブラリを選んだか]

### 主要機能・特徴
- **コア機能1**: [具体的な機能説明]
- **コア機能2**: [具体的な機能説明]
- **コア機能3**: [具体的な機能説明]
- **特徴・メリット**: [他ライブラリとの比較優位点]

### プロジェクトでの使用状況
- **使用箇所**: [ファイルパス一覧とgrep結果]
- **使用パターン**: [主要API・機能の使用方法]
- **設定・オプション**: [プロジェクト固有設定]
- **依存関係**: [他ライブラリとの関係]
- **重要度**: [High/Medium/Low] - [判定理由]
- **影響範囲**: [障害時の影響評価]

## 🔍 変更内容詳細
### 主要な変更点
[変更点のサマリー]

### Breaking Changes
- **有無**: [Yes/No]
- **内容**: [具体的な破壊的変更]
- **移行方法**: [必要な対応]

### 新機能・改善点
[新機能一覧]

### セキュリティ修正
[セキュリティ関連の修正内容]

## 🎯 影響範囲評価
- **直接影響ファイル数**: [数]ファイル
- **間接影響（依存関係）**: [数]パッケージ
- **影響度**: [High/Medium/Low]
- **リスク評価**: [詳細なリスク分析]

## ✅ 検証結果
### 静的解析
- **Linter**: [✅ Pass / ⚠️ Warning / ❌ Fail] - [詳細結果]
- **型チェック**: [✅ Pass / ⚠️ Warning / ❌ Fail] - [詳細結果]
- **コード品質**: [✅ Pass / ⚠️ Warning / ❌ Fail] - [詳細結果]

### セキュリティチェック
- **脆弱性スキャン**: [✅ Pass / ⚠️ Warning / ❌ Critical] - [詳細結果]
- **依存関係監査**: [✅ Pass / ⚠️ Warning / ❌ Fail] - [詳細結果]

### 機能テスト
**⚠️ 重要**: 実際のテストコード存在状況を明記
- **テストコード有無**: [存在する / 存在しない]
- **実行したテスト**: [具体的なテスト内容 / 未実行]
- **基本機能確認**: [✅ 確認済み / ⚠️ 理論的評価のみ / ❌ 問題あり] - [詳細]
- **エラーハンドリング**: [✅ 確認済み / ⚠️ 理論的評価のみ / ❌ 問題あり] - [詳細]
- **パフォーマンス**: [✅ 測定済み / ⚠️ 理論的評価のみ / ❌ 劣化] - [詳細]

### 検証状況サマリー
- **実行済み検証**: [具体的に実行した項目をリスト]
- **理論的分析のみ**: [理論的に評価した項目をリスト]  
- **未検証項目**: [確認が必要な項目をリスト]

## 🚨 推奨アクション
- [ ] **自動承認可能** - 安全な更新
- [ ] **手動レビュー推奨** - 注意が必要
- [ ] **追加テスト必要** - 詳細検証が必要
- [ ] **保留推奨** - 重大な問題あり

### 承認判定理由
[判定の根拠と理由]

## 🔧 手動確認事項
**⚠️ 手動確認要否**: [必要/不要]

### 必要な手動確認（該当する場合）
- [ ] **機能テスト**: [具体的な手順]
- [ ] **統合テスト**: [テスト範囲]
- [ ] **パフォーマンステスト**: [測定項目]
- [ ] **UI/UX確認**: [確認項目]
- [ ] **設定ファイル更新**: [必要な変更]

### 手動確認コマンド
```bash
# 開発環境セットアップ
[環境構築コマンド]

# 機能テスト実行
[テストコマンド]

# 期待結果
[期待される出力・動作]
```

## 📊 統計情報
- **調査実施日時**: [YYYY-MM-DD HH:MM:SS JST]
- **調査実行時間**: [X分]
- **チェックしたファイル数**: [数]
- **実行したテスト数**: [数]
- **検出した問題数**: [数]

## 💬 補足情報
[その他の気づき、注意点、コメント]

---
**🤖 自動調査レポート**  
*Generated by GitHub Copilot Coding Agent*  
*PR: #[自動取得したPR番号] | Branch: dependabot-analysis/[自動取得したpackage-name]-[自動取得したversion]*
```

### 2. 技術検証レポート
**ファイル**: `dependabot-review/#[自動取得したPR番号]/dependabot-review-technical-report.md`

```markdown
# 🔧 技術検証レポート - [自動取得したpackage-name]

## 📋 実行コマンドと結果

### パッケージ情報取得
```bash
# パッケージ詳細情報
[実行コマンド]
```
```
[コマンド出力結果]
```

### 使用箇所検索
```bash
# 使用箇所特定
[grepコマンド]
```
```
[検索結果]
```

### 依存関係確認
```bash
# 依存関係チェック
[依存関係確認コマンド]
```
```
[依存関係出力]
```

### 静的解析実行
```bash
# Linter実行
[lintコマンド]
```
```
[lint結果]
```

### セキュリティチェック
```bash
# セキュリティ監査
[auditコマンド]
```
```
[audit結果]
```

### テスト実行
```bash
# テスト実行
[testコマンド]
```
```
[テスト結果]
```

## 🔍 詳細分析

### ファイル変更影響
[変更されるファイルの詳細分析]

### API変更点
[APIの変更がある場合の詳細]

### 設定変更必要性
[設定ファイル更新の必要性]

## 📈 パフォーマンス分析
[パフォーマンスへの影響分析]

---
*Technical verification completed at [timestamp]*
```

### 3. 実証テストレポート
**ファイル**: `dependabot-review/#[自動取得したPR番号]/dependabot-review-[自動取得したpackage-name]-proof.md`

```markdown
# 🧪 実証テストレポート - [自動取得したpackage-name]

## 🎯 テスト概要
更新前後での[自動取得したpackage-name]の動作確認と互換性検証

## 📊 Before/After比較

### 更新前の状態
```bash
# バージョン確認
[version-check-command]
```
```json
{
  "version": "[自動取得したold-version]",
  "status": "before_update",
  "timestamp": "[timestamp]"
}
```

### 更新後の状態
```bash
# バージョン確認
[version-check-command]
```
```json
{
  "version": "[自動取得したnew-version]",
  "status": "after_update", 
  "timestamp": "[timestamp]"
}
```

## ⚡ 機能テスト結果

### テスト1: [機能名]
```bash
# テスト実行
[test-command-1]
```
```json
{
  "test": "[test-name]",
  "result": "✅ PASS",
  "execution_time": "[time]ms",
  "output": "[result-data]"
}
```

### テスト2: [機能名]
```bash
# テスト実行
[test-command-2]
```
```json
{
  "test": "[test-name]",
  "result": "✅ PASS",
  "execution_time": "[time]ms",
  "output": "[result-data]"
}
```

## 🚀 パフォーマンステスト

### 処理時間測定
```json
{
  "performance_comparison": {
    "before": {
      "version": "[old-version]",
      "execution_time": "[time]ms",
      "memory_usage": "[memory]MB"
    },
    "after": {
      "version": "[new-version]",
      "execution_time": "[time]ms", 
      "memory_usage": "[memory]MB"
    },
    "improvement": {
      "time_diff": "[diff]ms",
      "memory_diff": "[diff]MB",
      "percentage": "[percent]%"
    }
  }
}
```

## 🔍 互換性確認

### API互換性評価
- **非推奨メソッド**: [具体的なメソッド名または「なし」]
- **新規メソッド**: [具体的なメソッド名または「なし」]
- **破壊的変更**: [具体的な変更内容または「なし」]
- **互換性ステータス**: [✅ 互換性あり / ⚠️ 注意が必要 / ❌ 互換性なし]

### 検証方法
- **実際のテスト**: [実行した場合は具体的内容]
- **理論的分析**: [ドキュメント確認やバージョニングルールに基づく評価]
- **コミュニティ情報**: [GitHub Issues、フォーラムなどの情報源]

## 📋 テスト結果サマリー

### 実際の検証状況
- **実行されたテスト**: [具体的なテスト項目と結果]
- **理論的分析のみ**: [実際のテストを行わず理論的に評価した項目]
- **未検証項目**: [確認が必要だが未実行の項目]

### 総合評価
- **総テスト数**: [実際に実行したテスト数]
- **成功数**: [成功したテスト数]
- **失敗数**: [失敗したテスト数]  
- **警告数**: [警告が出たテスト数]
- **総合ステータス**: [✅ 全テスト成功 / ⚠️ 警告あり / ❌ 失敗あり / 🔍 テスト未実行]
- **推奨アクション**: [SAFE_TO_MERGE / MANUAL_VERIFICATION_REQUIRED / ADDITIONAL_TESTING_NEEDED]

### 注意事項
**⚠️ 重要**: このサマリーは実際に実行されたテストのみを含みます。理論的分析や推測は別途記載されています。

---
*Proof testing completed at [timestamp]*
```

## 🎯 コーディングエージェント実行指示

### 📋 PR情報自動解析パターン
コーディングエージェントは以下の方法でPR情報を自動取得・解析してください：

#### パターン1: PR番号指定の場合
```bash
# PR詳細取得
PR_INFO=$(gh pr view [指定されたPR番号] --json title,body,files,author,headRefName,baseRefName)

# パッケージ名とバージョンをPRタイトルから抽出
# 例: "Bump thor from 1.3.0 to 1.4.0" → package: thor, old: 1.3.0, new: 1.4.0
```

#### パターン2: PR URL指定の場合  
```bash
# URL からPR情報取得
PR_INFO=$(gh pr view [指定されたPR_URL] --json title,body,files,author,headRefName,baseRefName)
```

#### パターン3: 変更ファイルからの詳細抽出
```bash
# Gemfile.lock または package-lock.json の差分を確認
gh pr diff [PR番号] --name-only | grep -E "(Gemfile\.lock|package-lock\.json|yarn\.lock)"

# 具体的なバージョン変更を特定
gh pr diff [PR番号] -- Gemfile.lock | grep -A2 -B2 [package-name]
```

### 最終ステップ: 調査完了とPR作成
1. **調査結果のコミット**
   ```bash
   git add dependabot-review/
   git commit -m "📊 Dependabot調査完了: [自動取得したpackage-name] [自動取得したold-version]→[自動取得したnew-version]

   - 包括的な影響範囲分析完了
   - セキュリティ・互換性確認済み
   - 推奨アクション: [アクション]
   
   詳細: dependabot-review/#[自動取得したPR番号]/ 参照"
   ```

2. **調査PRの作成**
   - タイトル: `📊 Dependabot調査: [自動取得したpackage-name] [自動取得したold-version]→[自動取得したnew-version]`
   - 説明: 調査結果サマリーと推奨アクション

3. **元のDependabot PRへのリンク**
   - 調査PR説明文に元のDependabot PRへのリンクを記載
   - 調査結果に基づく承認/保留の推奨を明記

## 💡 重要な注意事項

### 🔍 必須確認項目
1. **PR情報の自動解析** - PRタイトル・本文・変更ファイルから情報抽出
2. **ライブラリ詳細調査は必須** - チーム知識共有のため
3. **全コマンド実行結果を記録** - 証跡として重要
4. **実際の検証内容を正確に記載** - テスト未実行の場合は明記
5. **具体的な推奨アクション** - 明確な次のステップを提示

### ⚠️ レポート作成時の注意事項
1. **架空のデータ禁止**: 実際に実行していないテスト結果やベンチマークデータを記載しない
2. **JSONの使用制限**: 実際のコマンド出力でない限り、JSONブロックは避ける（箇条書きを使用）
3. **理論的分析と実証の区別**: 理論的な互換性分析と実際のテスト結果を明確に分離
4. **テスト未実行の明記**: テストコードが存在しない場合や実行していない場合は必ず明記
5. **推測の根拠明示**: 判断の根拠となる具体的な情報源を記載

### 📝 データ表現ガイドライン
- **実際のコマンド出力**: コードブロックで囲み、実行コマンドと結果を明記
- **分析結果**: 箇条書きまたは表形式で表現、JSONは使用しない
- **理論的評価**: 「理論的に」「推測される」などの表現で明確に区別
- **未確認項目**: 「⚠️ 要確認」「未実行」などで明確にマーク

### ⚡ 自動化の利点
- **PR情報自動取得**: 番号やURLだけで全情報を取得
- **連続実行**: 操作許可なしで全調査を一気に実行
- **完全な証跡**: 全ての調査過程がコミット履歴に残る
- **標準化**: 一貫した品質の調査レポート
- **効率化**: 手動作業時間の大幅削減

### 🎯 使用方法
```
指定されたDependabot PR について、上記の手順で包括調査を実行してください。

対象PR: #[PR番号]
または
対象PR: https://github.com/[owner]/[repo]/pull/[number]

#github-pull-request_copilot-coding-agent
```

---
*このプロンプトはGitHubコーディングエージェントでの自動実行に最適化されています*  
*ベース: Dependabot PR 包括調査プロンプト (ローカル版)*
